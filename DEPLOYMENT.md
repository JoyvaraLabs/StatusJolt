# StatusJolt Deployment Guide

## Prerequisites

1. Cloudflare account
2. Wrangler CLI installed and authenticated
3. Node.js 18+

## Step-by-Step Deployment

### 1. Database Setup

Create D1 databases:

```bash
# Production database
npx wrangler d1 create statusjolt

# Development database  
npx wrangler d1 create statusjolt-dev
```

Update `wrangler.toml` with the generated database IDs.

### 2. Environment Variables

In Cloudflare Dashboard > Workers & Pages > Your Project > Settings > Environment Variables:

**Production:**
- `JWT_SECRET`: Strong random string (e.g., generated by `openssl rand -base64 32`)
- `STRIPE_SECRET_KEY`: Your Stripe secret key (optional for now)
- `STRIPE_WEBHOOK_SECRET`: Your Stripe webhook secret (optional)

**Development:**
- `JWT_SECRET`: Different random string for dev
- Other variables as needed

### 3. Database Migration

```bash
# Migrate development database
npm run db:migrate:dev

# Migrate production database
npm run db:migrate
```

### 4. Deploy

```bash
# Deploy to development
npm run deploy:dev

# Deploy to production
npm run deploy
```

### 5. Custom Domain (Optional)

In Cloudflare Dashboard:
1. Go to Workers & Pages > Your Project
2. Go to Custom domains
3. Add your domain (e.g., app.yourdomain.com)
4. Configure DNS in your domain registrar

### 6. Subdomain Routing

For status pages to work at subdomain.statusjolt.com:

1. In Cloudflare DNS, add:
   - `CNAME * statusjolt.pages.dev`
   - Or use a Worker route to handle subdomains

2. Alternative: Use the `/status/[subdomain]` route format

## Post-Deployment

1. Visit your deployed app
2. Create a test account
3. Create a test status page
4. Verify all functionality works
5. Set up monitoring and alerts

## Troubleshooting

**Build errors:**
- Check Node.js version (18+)
- Clear `node_modules` and reinstall
- Check TypeScript errors

**Database errors:**
- Verify database IDs in wrangler.toml
- Check that migrations ran successfully
- Verify environment variables are set

**Authentication errors:**
- Check JWT_SECRET is set
- Verify database connection
- Check browser cookies/localStorage

## Monitoring

Set up Cloudflare Analytics and consider:
- Uptime monitoring for your status page
- Error tracking (Sentry, etc.)
- Performance monitoring
- Database usage monitoring